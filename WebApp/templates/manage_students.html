<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Studenten beheren</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
</head>
<body>
  <h1>Studenten beheren</h1>

  <h3>Voeg een student toe</h3>
  <form id="addStudentsForm">
    <input id="studentnummer" type="text" placeholder="Studentnummer" name="studentnummer" required>
    <input id="name" type="text" placeholder="Naam" name="name" required>
    <select title="class" id="class" name="classes">
        <!-- classes will be added dynamically -->
    </select>
    <button type="submit">Opslaan</button>
</form>



<h2>Overzicht</h2>
     <table id="studentTable" border="1">
         <thead>
             <tr>
                 <th>Studentnummer</th>
                 <th>Naam</th>
                 <th>Klas</th>
                 <th>Datum ingevuld</th>
                 <th>Action Type</th>
                 <th>Team</th>
             </tr>
         </thead>
         <tbody>
             <!-- De tabelrijen worden hier toegevoegd -->
         </tbody>
     </table>
<script>
  $(document).ready(function() {
    // function to fill the table with student data
    function loadStudents() {
            console.log('Loading students...');
            $.ajax({
                type: 'GET',
                url: "{{ url_for('teacher.get_student_info') }}",
                dataType: 'json',
                success: function(data) {
                    const studentTableBody = $('#studentTable tbody');
                    studentTableBody.empty();  // Clear the table body before adding new rows

                    data.forEach(function(student) {
                        console.log('Student:', student);
                        // Check for "No Data" in action_date and replace it with "nvt"
                        const actionDate = student.action_date === 'No Data' ? "nvt" : student.action_date;
                        const actionType = student.action_type === 'No Data' ? "nvt" : student.action_type;
                        const teamName = student.team_name === 'No Team' ? "Niet ingedeeld" : student.team_name;
                        const tableRow = `
                            <tr>
                                <td>${student.student_number}</td>
                                <td>${student.student_name}</td>
                                <td>${student.student_class}</td>
                                <td>${actionDate}</td>
                                <td>${actionType}</td>
                                <td>${teamName}</td>
                            </tr>
                        `;
                        studentTableBody.append(tableRow);
                    });
                },
                error: function(xhr, status, error) {
                    console.error('Error fetching student data:', error);
                }
            });
        }

      // Function to populate the dropdown with class data
      function populateClassDropdown() {
          $.ajax({
              url: " {{ url_for('teacher.get_classes') }} ", // Flask endpoint that returns the class data
              type: 'GET',
              dataType: 'json',
              success: function(data) {
                  const classSelect = $('#class');
                  classSelect.empty(); // Clear any existing options

                  // Add a default option
                  classSelect.append('<option value="">Selecteer een klas</option>');

                  // Iterate over the returned data to create options
                  data.forEach(function(classItem) {
                      const option = `<option value="${classItem.class}">${classItem.class}</option>`;
                      classSelect.append(option);
                  });
              },
              error: function(xhr, status, error) {
                  console.error('Error fetching class data:', error);
              }
          });
        
        
        }
      

     

      // Call the function to populate the dropdown on page load
      populateClassDropdown();

       // Call the function to load students on page load
       loadStudents();

      

      // add new student to the database
      $('#addStudentsForm').submit(function(event) {
          event.preventDefault();
          const studentnummer = $('#studentnummer').val();
          const name = $('#name').val();
          const class_student = $('#class').val();
          console.log('Adding student:', studentnummer, name, class_student);

          $.ajax({
              url: " {{ url_for('teacher.add_student') }} ",
              type: 'POST',
              contentType: 'application/json',
              data: JSON.stringify({
                  student_number: studentnummer,
                  name: name,
                  student_class: class_student
              }),
              success: function(response) {
                  console.log('Student added successfully:', response);
                  alert('Student succesvol toegevoegd');
                  // Clear the form fields after successful submission
                  $('#studentnummer').val('');
                  $('#name').val('');
                  $('#class').val('');

                  // Reload the students list
                  loadStudents();
              },
              error: function(xhr, status, error) {
                  console.error('Error adding student:', error);
              }
          });
      });
  });


</script>
</body>
</html>