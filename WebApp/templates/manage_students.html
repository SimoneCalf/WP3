<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Studenten beheren</title>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <style>
        /* Voeg hier je CSS-stijlen toe */
        .svg-container {
            width: 12%;
            max-width: 75px; /* Pas de breedte aan indien nodig */
            margin: 0 auto;
            margin-left: 1%;
        }
        svg {
            width: 100%; /* Past de SVG aan de breedte van de container aan */
            height: auto; /* Zorgt ervoor dat de hoogte proportioneel blijft */
        }

        .text {
            font-size: 20px;
            font-family: Arial, sans-serif;
            margin-top: 60px;
        }

        .select {
            text-align: center;
        }

        .select-container {
            margin-bottom: 1%;
            display: flex; /* Zet de select-elementen naast elkaar */
            align-items: center; /* Optioneel, centreert de select-elementen verticaal */
            gap: 20px; /* Ruimte tussen de select-elementen */
            margin-left: 905px; /* Ruimte aan de linkerkant van de select-elementen */
        }
        .add-student {
            text-align: center;
            margin-bottom: 3%;
        }

        .name_page {
            margin-bottom: 5%;
            text-align: center;
            margin-top: 0px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            border: 2px solid black; /* Zwarte rand om de tabel */
        }

        th {
            background-color: #cf0245; /* Maakt de achtergrond van de headers rood */
            color: white; /* Maakt de tekst wit */
            padding: 10px;
            text-align: left;
            border: 2px solid black; /* Zwarte rand om de headers */
        }

        td {
            padding: 10px;
            border: 2px solid black; /* Zwarte rand om de cellen */
        }


        

    </style>
</head>
<body>
    <div class="svg-container">
        <svg id="Layer_1" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 2978.3 2978.3" width="2978.3" height="2978.3">
            <style>
                .st0 { fill: #cf0245; }
                .st1 { fill: #fff; }
            </style>
            <path class="st0" d="M501.8 2978.3h2476.5V501.7S2978.3 0 2476.5 0H501.7S0 0 0 501.8v1974.7c0 .1 0 501.8 501.8 501.8z"/>
            <path class="st1" d="M1966.3 1002c73.1-83.5 125.1-174.7 147.2-260.2 12.3-47.9 15.3-94 7.1-136-35.7-185.9-273.4-221.5-531.9-80.5l-35.3-183.4L1279.9 493l44.3 230.1c28.5-17.9 56.7-29.5 82.3-32.1 87.1-9 111.6 85.9 55 211.9-20 44.6-47.7 87-78.9 123.8l51.9 269.7c.1.2.1.3.1.3l.9 4.8.2-.1c39.3 182.5 277.4 215.7 535.5 73.3 255-140.9 434.4-400.7 408.1-587-10.4 74.3-84 166-182.6 220.5-104.7 57.7-201.4 53.8-230.2-5.4 0-.5-.2-.7-.2-.8zM1201.3 1147c-87.1 8.9-111.6-86-55-211.9 22.7-50.4 54.9-97.9 91-137.7l-48.9-254-538.3 297.2L805.7 1649l538.3-297.2-47.3-245.6c-32.9 22.9-65.8 37.7-95.4 40.8zM458.2 2190.5v-101.1h-94.4v101.1h-49.6v-241h49.6v94.5h94.4v-94.5h49.6v241zM671.6 2195.9c-68.6 0-122.4-50.3-122.4-121 0-73.3 53.1-129.5 126.3-129.5 70.8 0 124.9 48.4 124.9 122.1.1 76.4-55.1 128.4-128.8 128.4zm2.9-203.2c-39 0-72.5 28.7-72.5 78.6 0 52 35.4 78.2 72.5 78.2 39.6 0 72.9-25.5 72.9-77.8 0-50.6-31.4-79-72.9-79zM966.6 2194.5c-68.7 0-132.4-30.5-132.4-123.6 0-81.8 55.6-125 130.9-125 38.6 0 64.4 10.9 75.7 19.5l-13.8 47.1c-11.3-9.3-35.7-21-64.8-21-40.7 0-73.9 25.2-73.9 79.4 0 53.4 33.6 81 83.2 81 10.6 0 28.7-1.1 36.1-6.4v-69h48.2v95.6c-16.4 11.1-48.9 22.4-89.2 22.4zM1104.6 2190.5v-241h145.8v43.6h-95.9v50.6h87.7v43.8h-87.7v59.5h104.7v43.5zM1379.2 2194.8c-43.2 0-67.9-13.8-85-23.7l10.6-51.8c18.8 15.3 51.7 29.8 70.8 29.8 22.3 0 35.1-10.2 35.1-24.4 0-14.5-7.8-24.4-24.5-29.7l-32.6-10.6c-47.8-15.5-52.8-39.6-52.8-71.5 0-30.1 30.5-67.6 79.4-67.6 36.8 0 53.8 5.2 74.4 19.5l-11.7 51.7c-22.3-19.8-39.6-25.2-59.4-25.2-18.1 0-31.2 10.2-31.2 20.6 0 13.1 7.5 20.1 25.5 26.2l30.1 10c45.3 14.8 55.2 40.3 55.2 74 0 37.7-36.5 72.7-83.9 72.7zM1617.8 2194.5c-59.9 0-120-31.3-120-119.7 0-75.1 43.2-128.2 122.9-128.2 43.9 0 72.2 19.9 72.2 19.9l-16.6 47.4c-17.1-13.4-33.4-20.2-58.4-20.2-41.5 0-68.7 29.8-68.7 75.8 0 55.9 41 76.4 76.1 76.4 27.6 0 42.2-6.3 58.7-20.6l17 44.2c-25.2 19.7-53.5 25-83.2 25zM1892.8 2190.5v-101.1h-94.4v101.1h-49.7v-241h49.7v94.5h94.4v-94.5h49.5v241zM2106.2 2195.9c-68.6 0-122.5-50.3-122.5-121 0-73.3 53.1-129.5 126.3-129.5 70.9 0 125 48.4 125 122.1 0 76.4-55.1 128.4-128.8 128.4zm2.9-203.2c-38.9 0-72.5 28.7-72.5 78.6 0 52 35.4 78.2 72.5 78.2 39.6 0 73-25.5 73-77.8-.1-50.6-31.6-79-73-79zM2390.7 2195.9c-68.5 0-122.4-50.3-122.4-121 0-73.3 53.1-129.5 126.4-129.5 70.8 0 125 48.4 125 122.1 0 76.4-55.3 128.4-129 128.4zm3-203.2c-38.9 0-72.6 28.7-72.6 78.6 0 52 35.4 78.2 72.6 78.2 39.6 0 72.9-25.5 72.9-77.8-.1-50.6-31.5-79-72.9-79zM2563.2 2190.5v-241h49.6v196.4h105v44.6zM583.9 2591.4l-69.4-94.8-14.9-.4v94.1h-49.5V2350s42.1-3.2 71.1-3.2c57.3 0 84.6 27.2 84.6 74 0 35.9-21.5 59.4-38.5 67.8l70.4 92-53.8 10.8zm-60.8-201.1c-7.8 0-17 .8-23.7 1.4v63.7s14.5 1.8 23.7 1.8c21.6 0 32.9-14.7 32.9-35.1 0-18-12.4-31.8-32.9-31.8zM767.3 2595.6c-68.7 0-122.5-50.3-122.5-121 0-73.2 53.1-129.5 126.4-129.5 70.8 0 125 48.4 125 122.1-.1 76.4-55.4 128.4-128.9 128.4zm2.7-203.2c-38.9 0-72.5 28.7-72.5 78.5 0 52.1 35.4 78.2 72.5 78.2 39.7 0 72.9-25.5 72.9-77.9.1-50.4-31.4-78.8-72.9-78.8zM1039.1 2396.3v193.9h-49.6V2397h-68.3v-47.4h185.5v46.7zM1257.8 2396.3v193.9h-49.6V2397h-68.4v-47.4h185.6v46.7zM1361.5 2590.2v-240.9h145.8v43.5h-95.9v50.6h87.7v43.9h-87.7v59.5h104.8v43.4zM1700.2 2591.4l-69.4-94.8-14.8-.4v94.1h-49.6V2350s42.2-3.2 71.1-3.2c57.5 0 84.7 27.2 84.7 74 0 35.9-21.7 59.4-38.5 67.8l70.4 92-53.9 10.8zm-60.9-201.1c-7.8 0-17 .8-23.7 1.4v63.7s14.5 1.8 23.7 1.8c21.6 0 33-14.7 33-35.1 0-18-12.5-31.8-33-31.8zM1862 2594.5c-35.8 0-76.5-5.3-76.5-5.3v-239.6s43.9-4.6 79.3-4.6c95.3 0 132.4 51 132.4 114.7-.1 69.7-35.4 134.8-135.2 134.8zm8.5-204.2c-12.8 0-34.8 1.8-34.8 1.8v155.3c6.3 2.1 19.1 4.2 37.2 4.2 42.5 0 72.6-39.7 72.6-84.9 0-50.2-39.6-76.4-75-76.4zM2186.8 2591l-24.7-60.5h-84.2l-24.9 59.7h-51.6l101.6-240.6h42.7l94.2 241-53.1.4zm-65.4-178.4l-30.8 79.4h59.1l-28.3-79.4zM2526.7 2591l-32.9-139.4-63.7 139h-35.5l-61.8-139-29.9 139-48.1-.4 52.8-237.1h41.1l67.2 160 73.3-163.5h36.1l56.6 240.6z"/>
        </svg>
    </div>
<div class="text">
<div class="name_page">
    <h1>Studenten beheren</h1>
</div>
<div class="add-student">
    <p>Voeg een student toe</p>
    <form id="addStudentsForm">
      <input id="studentnummer" type="text" placeholder="Studentnummer" name="studentnummer" required>
      <input id="name" type="text" placeholder="Naam" name="name" required>
      <select title="class" id="class" name="classes">
          <!-- classes will be added dynamically -->
      </select>
      <button type="submit">Opslaan</button>
  </form>
</div>

<div class="select-container">
    <div class="select">
        <select title="teams" id="teamSelect">
            <option value="">Team</option>
            <!-- Teams will be added dynamically -->
        </select>
    </div>
    <div class="select">
        <select title="classes" id="classSelect">
            <option value="">Klas</option>
            <!-- Classes will be added dynamically -->
        </select>
    </div>
</div>


     <table id="studentTable" border="1">
         <thead class="headers">
             <tr>
                 <th>Studentnummer</th>
                 <th>Naam</th>
                 <th>Klas</th>
                 <th>Datum ingevuld</th>
                 <th>Action Type</th>
                 <th>Team</th>
                 <th>Ingedeeld door</th>
                 <th>Acties</th>
             </tr>
         </thead>
         <tbody>
             <!-- De tabelrijen worden hier toegevoegd -->
         </tbody>
     </table>
    </div>
<script>
// function to fill the table with student data
function loadStudents() {
            $.ajax({
                type: 'GET',
                url: "{{ url_for('teacher.get_student_info') }}",
                dataType: 'json',
                success: function(data) {
                    const studentTableBody = $('#studentTable tbody');
                    studentTableBody.empty();  // Clear the table body before adding new rows

                    data.forEach(function(student) {
                        // Check for "No Data" in action_date and replace it with "nvt"
                        const studentNumber = student.student_number
                        const actionDate = student.action_date === 'No Data' ? "nvt" : student.action_date;
                        const actionType = student.action_type === 'No Data' ? "nvt" : student.action_type;
                        const teamName = student.team_name === 'No Team' ? "Niet ingedeeld" : student.team_name;
                        const tableRow = `
                            <tr>
                                <td>${student.student_number}</td>
                                <td>${student.student_name}</td>
                                <td>${student.student_class}</td>
                                <td>${actionDate}</td>
                                <td>${actionType}</td>
                                <td>${teamName}</td>
                                <td>${student.assigned_by}</td>
                                <td>
                                    <button onclick="goToDetailPage(${student.student_number})" class="aanpas-btn">Aanpassen</button>
                                    <button onclick="deleteStudent(${student.student_number})" class="verwijder-btn" data-id="${student.student_number}">Verwijderen</button>
                                </td>
                            </tr>
                        `;
                        studentTableBody.append(tableRow);
                    });
                },
                error: function(xhr, status, error) {
                    console.error('Error fetching student data:', error);
                }
            });
        }

    function goToDetailPage(studentNumber) {
        const baseUrl = window.location.origin;
        const detailUrl = `${baseUrl}/teacher/student_detail/${studentNumber}`;
        window.location.href = detailUrl
    }

    // Function to delete a student
    function deleteStudent(studentNumber) {
        const url = `delete_student/${studentNumber}`;
        // Send a DELETE request to the server
        $.ajax({
            url: url,
            type: 'DELETE',
            success: function(response) {
                alert('Student succesvol verwijderd');
                // Reload the students list
                loadStudents();
            },
            error: function(xhr, status, error) {
                console.error('Error deleting student:', error);
            }
        });
         // Call the function to load students on page load
       loadStudents();
    }




  $(document).ready(function() {
    let selectedTeamId = null;
    let selectedClassId = null;
      // Function to populate the dropdown with class data
      function populateClassDropdown() {
          $.ajax({
              url: " {{ url_for('teacher.get_classes') }} ", // Flask endpoint that returns the class data
              type: 'GET',
              dataType: 'json',
              success: function(data) {
                  const classSelect = $('#class');
                  classSelect.empty(); // Clear any existing options

                  // Add a default option
                  classSelect.append('<option value="">Selecteer een klas</option>');

                  // Iterate over the returned data to create options
                  data.forEach(function(classItem) {
                      const option = `<option value="${classItem.class}">${classItem.class}</option>`;
                      classSelect.append(option);
                  });

                  const classSelect2 = $('#classSelect');
                    classSelect2.empty(); // Clear any existing options

                    // Add a default option
                    classSelect2.append('<option value="">Selecteer een klas</option>');

                    // Iterate over the returned data to create options
                    data.forEach(function(classItem) {
                        const option = `<option value="${classItem.class}">${classItem.class}</option>`;
                        classSelect2.append(option);
                    });
              },
              error: function(xhr, status, error) {
                  console.error('Error fetching class data:', error);
              }
          });
        
        
        }

        function populateTeamDropdown() {
            $.ajax({
                url: " {{ url_for('teacher.get_teams') }} ", // Flask endpoint that returns the team data
                type: 'GET',
                dataType: 'json',
                success: function(data) {
                    const teamSelect = $('#teamSelect');
                    teamSelect.empty(); // Clear any existing options

                    // Add a default option
                    teamSelect.append('<option value="">Selecteer een team</option>');

                    // Iterate over the returned data to create options
                    data.forEach(function(teamItem) {
                        const option = `<option value="${teamItem.name}">${teamItem.name}</option>`;
                        teamSelect.append(option);
                    });
                },
                error: function(xhr, status, error) {
                    console.error('Error fetching team data:', error);
                }
            });
        }

        // Function to load students based on selected class and/or team
    function loadStudentsByClassAndOrTeam(className, teamName) {
        $.ajax({
            url: "{{ url_for('teacher.get_students_by_class_and_or_team') }}", // Een enkele Flask-endpoint die beide opties aankan
            type: 'POST',
            contentType: 'application/json',
            data: JSON.stringify({ class_name: className, team_name: teamName }),
            success: function(data) {
                const studentTableBody = $('#studentTable tbody');
                studentTableBody.empty(); // Clear the table body before adding new rows

                data.forEach(function(student) {
                    const actionDate = student.action_date === 'No Data' ? "n.v.t." : student.action_date;
                    const actionType = student.action_type === 'No Data' ? "Vragen nog niet beantwoord" : student.action_type;
                    const teamName = student.team_name === null ? "Niet ingedeeld" : student.team_name;
                    const assignedBy = student.assigned_by === null || student.assigned_by === 'No Data' ? "n.v.t." : student.assigned_by;
                    const tableRow = `
                        <tr>
                            <td>${student.student_number}</td>
                            <td>${student.student_name}</td>
                            <td>${student.student_class}</td>
                            <td>${actionDate}</td>
                            <td>${actionType}</td>
                            <td>${teamName}</td>
                            <td>${assignedBy}</td>
                            <td>
                                <button onclick="goToDetailPage(${student.student_number})" class="aanpas-btn">Aanpassen</button>
                                <button onclick="deleteStudent(${student.student_number})" class="verwijder-btn" data-id="${student.student_number}">Verwijderen</button>
                            </td>
                        </tr>
                    `;
                    studentTableBody.append(tableRow);
                });
            },
            error: function(xhr, status, error) {
                console.error('Error fetching student data:', error);
            }
        });
    }

    // Event listener for team selection change
    $('#teamSelect').change(function() {
        selectedTeamId = $(this).val();
        loadStudentsByClassAndOrTeam(selectedClassId, selectedTeamId);
    });

    // Event listener for class selection change
    $('#classSelect').change(function() {
        selectedClassId = $(this).val();
        loadStudentsByClassAndOrTeam(selectedClassId, selectedTeamId);
    });


    // Call the function to populate the dropdown on page load
    populateClassDropdown();
    
    // Call the function to populate the dropdown with the teams on page load
    populateTeamDropdown();

    // Call the function to load students on page load
    loadStudents();


      

      // add new student to the database
      $('#addStudentsForm').submit(function(event) {
          event.preventDefault();
          const studentnummer = $('#studentnummer').val();
          const name = $('#name').val();
          const class_student = $('#class').val();

          $.ajax({
              url: " {{ url_for('teacher.add_student') }} ",
              type: 'POST',
              contentType: 'application/json',
              data: JSON.stringify({
                  student_number: studentnummer,
                  name: name,
                  student_class: class_student
              }),
              success: function(response) {
                  alert('Student succesvol toegevoegd');
                  // Clear the form fields after successful submission
                  $('#studentnummer').val('');
                  $('#name').val('');
                  $('#class').val('');

                  // Reload the students list
                  loadStudents();
              },
              error: function(xhr, status, error) {
                  console.error('Error adding student:', error);
              }
          });
      });
  });


</script>
</body>
</html>